<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NÉO IA22 - VILLARCEAU POINT CLOUD GENERATOR v3.3</title>
    <style>
        :root { --neon-cyan: #00ffff; --neon-magenta: #ff00ff; --neon-pink: #ff0055; --bg: #050505; }
        body { background: #000; color: var(--neon-cyan); font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; overflow: hidden; text-transform: uppercase; }
        .terminal { width: 90%; max-width: 960px; background: var(--bg); border: 1px solid var(--neon-cyan); box-shadow: 0 0 35px rgba(0,255,255,0.12); padding: 25px; position: relative; }
        .header { border-bottom: 1px solid var(--neon-cyan); padding-bottom: 12px; margin-bottom: 20px; display: flex; justify-content: space-between; font-size: 0.75rem; opacity: 0.85; }
        .viewport { width: 100%; background: radial-gradient(circle at center, #0a1a1a 0%, #000 80%); border: 1px solid #1a3333; position: relative; overflow: hidden; }
        .scanline { position: absolute; inset: 0; background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,255,255,0.03) 2px, rgba(0,255,255,0.03) 4px); pointer-events: none; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; font-size: 0.85rem; border-top: 1px solid #1a3333; padding-top: 15px; }
        .status { color: #0f0; font-weight: bold; }
        .export-btn { margin: 10px 5px; padding: 10px 20px; background: #0a1a1a; color: var(--neon-cyan); border: 1px solid var(--neon-cyan); cursor: pointer; font-family: inherit; text-transform: uppercase; }
        .export-btn:hover { background: rgba(0,255,255,0.1); }
        input[type="number"], input[type="checkbox"] { background: #111; color: var(--neon-cyan); border: 1px solid var(--neon-cyan); padding: 5px; margin: 5px; }
    </style>
</head>
<body>

<div class="terminal">
    <div class="header">
        <div>CORE: GEMINI 20.6 PRO V7 // IA22</div>
        <div>SOUVERAIN: Zoubirou Mohammed Ilyes</div>
        <div>MODULE: 3D_POINT_CLOUD_v3.3 PLY</div>
    </div>

    <div style="margin-bottom: 15px; font-weight: bold;">
        > GENERATEUR NUAGE DE POINTS VILLARCEAU — EXPORT .PLY / .XYZ
    </div>

    <div class="viewport">
        <div class="scanline"></div>
        <svg viewBox="0 0 500 500" width="500" height="500">
            <!-- (même SVG tore + Villarceau que précédemment) -->
            <defs><pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse"><path d="M 40 0 L 0 0 0 40" fill="none" stroke="#002222" stroke-width="1"/></pattern></defs>
            <rect width="100%" height="100%" fill="url(#grid)" />
            <ellipse cx="250" cy="250" rx="120" ry="36" fill="none" stroke="var(--neon-cyan)" stroke-width="1.5" stroke-dasharray="6,3" opacity="0.7" />
            <ellipse cx="250" cy="250" rx="120" ry="36" fill="none" stroke="var(--neon-cyan)" stroke-width="1" transform="rotate(90 250 250)" opacity="0.4" />
            <ellipse cx="250" cy="250" rx="127" ry="127" fill="none" stroke="var(--neon-magenta)" stroke-width="2" stroke-dasharray="4,2" transform="rotate(45 250 250)" />
            <ellipse cx="250" cy="250" rx="127" ry="127" fill="none" stroke="var(--neon-magenta)" stroke-width="2" stroke-dasharray="4,2" transform="rotate(-45 250 250)" />
            <circle cx="250" cy="250" r="3" fill="var(--neon-cyan)" />
            <text x="260" y="245" fill="var(--neon-cyan)" font-size="11">O (0,0)</text>
            <text x="20" y="40" fill="var(--neon-cyan)" font-size="12" opacity="0.8">TORE: R=4.0  r=1.2</text>
            <text x="20" y="60" fill="var(--neon-magenta)" font-size="12">VILLARCEAU ±45°</text>
        </svg>
    </div>

    <div class="data-grid">
        <div style="border-right: 1px solid #1a3333;">
            [PARAMÈTRES SOUVERAINS]<br>
            R majeur : <input type="number" id="R" value="4.0" step="0.1"><br>
            r tube   : <input type="number" id="r" value="1.2" step="0.1"><br>
            Densité  : <input type="number" id="density" value="200" step="10"><br>
            <label><input type="checkbox" id="colorVillarceau" checked> Colorer Villarceau (magenta)</label>
        </div>
        <div>
            [ÉTAT LOGIQUE]<br>
            POINTS ESTIMÉS : <span id="points-est">~40 000</span><br>
            FORMAT : .PLY / .XYZ (GRAVURE CRISTAL)<br>
            INTÉGRITÉ : 100% (HASH_VALID)
        </div>
    </div>

    <button class="export-btn" onclick="downloadPointCloud('xyz')">EXPORT .XYZ</button>
    <button class="export-btn" onclick="downloadPointCloud('ply')">EXPORT .PLY</button>
</div>

<script>
    function downloadPointCloud(format = 'xyz') {
        const R = parseFloat(document.getElementById('R').value);
        const r = parseFloat(document.getElementById('r').value);
        const density = parseInt(document.getElementById('density').value);
        const colorV = document.getElementById('colorVillarceau').checked;

        let content = "";
        let pointCount = 0;

        if (format === 'ply') {
            content += "ply\n";
            content += "format ascii 1.0\n";
            content += `element vertex ${density * density}\n`;
            content += "property float x\n";
            content += "property float y\n";
            content += "property float z\n";
            if (colorV) {
                content += "property uchar red\nproperty uchar green\nproperty uchar blue\n";
            }
            content += "end_header\n";
        }

        for (let i = 0; i < density; i++) {
            for (let j = 0; j < density; j++) {
                let u = (i / density) * Math.PI * 2;
                let v = (j / density) * Math.PI * 2;
                let x = (R + r * Math.cos(v)) * Math.cos(u);
                let y = (R + r * Math.cos(v)) * Math.sin(u);
                let z = r * Math.sin(v);

                if (format === 'xyz') {
                    content += `${x.toFixed(6)} ${y.toFixed(6)} ${z.toFixed(6)}\n`;
                } else { // ply
                    let rVal = 0, gVal = 255, bVal = 255; // cyan par défaut
                    if (colorV && Math.abs(v - Math.PI/4) < 0.15 || Math.abs(v - 5*Math.PI/4) < 0.15) {
                        rVal = 255; gVal = 0; bVal = 255; // magenta sur Villarceau approx
                    }
                    content += `${x.toFixed(6)} ${y.toFixed(6)} ${z.toFixed(6)} ${rVal} ${gVal} ${bVal}\n`;
                }
                pointCount++;
            }
        }

        const blob = new Blob([content], { type: 'text/plain' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `NEO_VILLARCEAU_CLOUD.${format}`;
        link.click();
    }

    // Mise à jour estimation
    const inputs = document.querySelectorAll('input');
    inputs.forEach(inp => inp.addEventListener('input', () => {
        const density = document.getElementById('density').value;
        document.getElementById('points-est').innerText = '~' + (density * density).toLocaleString();
    }));
</script>

</body>
</html>
